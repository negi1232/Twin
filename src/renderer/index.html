<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; img-src 'self' data:; object-src 'none'; base-uri 'self'; form-action 'self'; frame-ancestors 'none';">
  <title>Twin - CSS Comparison Tool</title>
  <link rel="stylesheet" href="styles/main.css">
</head>
<body>
  <!-- Toolbar -->
  <div id="toolbar">
    <div class="toolbar-section toolbar-toggle">
      <button id="toggle-sidebar" class="btn btn-icon" title="Toggle Sidebar">&#x2630;</button>
    </div>
    <div class="toolbar-section toolbar-left">
      <label class="url-label">Expected</label>
      <input type="text" id="left-url" class="url-input" placeholder="http://localhost:3000" />
      <button id="reload-left" class="btn btn-icon" title="Reload Left">&#x21bb;</button>
    </div>

    <div class="toolbar-section toolbar-center">
      <div class="preset-buttons">
        <button class="btn btn-preset" data-preset="0">SE</button>
        <button class="btn btn-preset" data-preset="1">14P</button>
        <button class="btn btn-preset" data-preset="2">iPad</button>
        <button class="btn btn-preset" data-preset="3">DT</button>
        <button class="btn btn-preset" data-preset="4">FHD</button>
      </div>
      <div class="toolbar-actions">
        <button id="toggle-sync" class="btn sync-on" title="Toggle Sync"><span class="sync-dot"></span>Sync ON</button>
        <button id="reload-sync-btn" class="btn btn-icon" title="Reload &amp; Re-sync (Cmd+R)">&#x21bb;</button>
        <div class="zoom-controls">
          <button id="zoom-out-btn" class="btn btn-icon" title="Zoom Out (Cmd+-)">&#x2212;</button>
          <button id="zoom-level-btn" class="btn btn-zoom-level" title="Reset Zoom (Cmd+0)">100%</button>
          <button id="zoom-in-btn" class="btn btn-icon" title="Zoom In (Cmd+=)">&#x2b;</button>
        </div>
        <button id="css-scan-btn" class="btn" title="CSS Full Scan (Cmd+Shift+C)">&#x1F3A8; CSS Scan</button>
        <button id="css-inspect-btn" class="btn" title="CSS Inspect Mode (Cmd+I)">&#x1F50D; Inspect</button>
        <button id="new-report-btn" class="btn" title="New Report">&#x2795; New</button>
        <button id="capture-btn" class="btn" title="Capture & Compare (Cmd+Shift+S)">&#x1F4F7; Capture</button>
        <button id="report-btn" class="btn" title="Open Report (Cmd+Shift+O)">&#x1F4CB; Report</button>
        <button id="settings-btn" class="btn btn-icon" title="Settings (Cmd+,)">&#x2699;</button>
      </div>
    </div>

    <div class="toolbar-section toolbar-right">
      <label class="url-label">Actual</label>
      <input type="text" id="right-url" class="url-input" placeholder="http://localhost:3001" />
      <button id="reload-right" class="btn btn-icon" title="Reload Right">&#x21bb;</button>
    </div>
  </div>

  <!-- Sidebar File Browser -->
  <div id="sidebar" class="sidebar collapsed">
    <div class="sidebar-header">
      <button id="sidebar-select-folder" class="btn btn-sm">Open Folder</button>
      <button id="sidebar-new-folder" class="btn btn-sm btn-icon" title="New Folder">&#x2795;</button>
    </div>
    <div id="sidebar-new-folder-form" class="sidebar-new-folder-form hidden">
      <input type="text" id="sidebar-new-folder-name" class="sidebar-new-folder-input" placeholder="folder name" />
      <button id="sidebar-new-folder-ok" class="btn btn-sm btn-primary">OK</button>
      <button id="sidebar-new-folder-cancel" class="btn btn-sm">&#x2715;</button>
    </div>
    <div class="sidebar-output-info">
      <span class="sidebar-output-label">Output</span>
      <span id="sidebar-output-dir" class="sidebar-output-path" title="">Not set</span>
    </div>
    <div class="sidebar-controls">
      <div class="sidebar-control-group">
        <label for="sidebar-sort" class="sidebar-label">Sort</label>
        <select id="sidebar-sort" class="sidebar-select">
          <option value="name-asc">Name A-Z</option>
          <option value="name-desc">Name Z-A</option>
          <option value="type">Type</option>
        </select>
      </div>
      <div class="sidebar-control-group sidebar-filter-group">
        <span class="sidebar-label">Filter</span>
        <label class="sidebar-radio"><input type="radio" name="sidebar-filter" value="all" checked />All</label>
        <label class="sidebar-radio"><input type="radio" name="sidebar-filter" value="directories" />Dirs</label>
        <label class="sidebar-radio"><input type="radio" name="sidebar-filter" value="files" />Files</label>
      </div>
    </div>
    <div id="sidebar-tree" class="sidebar-tree"></div>
  </div>

  <!-- BrowserViews are managed by the main process, this area is a placeholder -->
  <div id="view-container"></div>

  <!-- Status Bar -->
  <div id="status-bar">
    <span id="status-size">-- x --</span>
    <span class="status-divider">|</span>
    <span id="status-zoom">Zoom: 100%</span>
    <span class="status-divider">|</span>
    <span id="status-sync">Sync: ON</span>
    <span class="status-divider">|</span>
    <span id="status-result">Ready</span>
  </div>

  <!-- Settings Modal -->
  <div id="settings-modal" class="modal hidden">
    <div class="modal-overlay"></div>
    <div class="modal-content">
      <h2>Settings</h2>
      <div class="form-group">
        <label for="setting-matching-threshold">Matching Threshold (0-1)</label>
        <input type="number" id="setting-matching-threshold" min="0" max="1" step="0.01" value="0" />
      </div>
      <div class="form-group">
        <label for="setting-threshold-rate">Threshold Rate (0-1)</label>
        <input type="number" id="setting-threshold-rate" min="0" max="1" step="0.01" value="0" />
      </div>
      <div class="form-group">
        <label for="setting-snapshot-dir">Snapshot Directory</label>
        <input type="text" id="setting-snapshot-dir" value="./snapshots" />
      </div>
      <div class="modal-actions">
        <button id="settings-save" class="btn btn-primary">Save</button>
        <button id="settings-cancel" class="btn">Cancel</button>
      </div>
    </div>
  </div>

  <!-- New Report Modal -->
  <div id="new-report-modal" class="modal hidden">
    <div class="modal-overlay"></div>
    <div class="modal-content">
      <h2>New Report</h2>
      <div id="new-report-folder-info" class="form-info hidden">
        <span class="form-info-label">Save to</span>
        <span id="new-report-folder-path" class="form-info-value"></span>
      </div>
      <div class="form-group">
        <label for="report-test-name">Test Name</label>
        <input type="text" id="report-test-name" placeholder="e.g. login-page, top-hero" />
      </div>
      <div class="modal-actions">
        <button id="new-report-capture" class="btn btn-primary">Capture</button>
        <button id="new-report-cancel" class="btn">Cancel</button>
      </div>
    </div>
  </div>

  <!-- File Preview Modal -->
  <div id="preview-modal" class="modal hidden">
    <div class="modal-overlay" id="preview-overlay"></div>
    <div class="preview-content">
      <div class="preview-header">
        <span id="preview-filename" class="preview-filename"></span>
        <button id="preview-close" class="btn btn-icon preview-close-btn">&times;</button>
      </div>
      <div class="preview-body">
        <img id="preview-image" class="preview-image" alt="" />
      </div>
    </div>
  </div>

  <!-- CSS Inspect Drawer -->
  <div id="css-inspect-drawer" class="css-inspect-drawer hidden">
    <div id="css-inspect-drawer-handle" class="css-inspect-drawer-handle"></div>
    <div class="css-inspect-drawer-header">
      <div id="css-inspect-header-info" class="css-inspect-header-info">
        Click an element to inspect
      </div>
      <div class="css-inspect-drawer-filters">
        <button id="css-inspect-filter-diff" class="css-inspect-filter-btn active" title="差分があるプロパティのみ表示">Diff Only</button>
        <button id="css-inspect-filter-all" class="css-inspect-filter-btn" title="すべてのプロパティを表示">All Props</button>
        <span class="css-inspect-filter-sep">|</span>
        <button class="css-inspect-cat-btn active" data-cat="all" title="すべてのカテゴリ">All</button>
        <button class="css-inspect-cat-btn" data-cat="layout" title="レイアウト系 (display, position, flex, margin等)">Layout</button>
        <button class="css-inspect-cat-btn" data-cat="text" title="テキスト系 (font, color, text-align等)">Text</button>
        <button class="css-inspect-cat-btn" data-cat="visual" title="装飾系 (background, shadow, border-color等)">Visual</button>
        <button class="css-inspect-cat-btn" data-cat="other" title="その他のプロパティ">Other</button>
      </div>
      <button id="css-inspect-drawer-close" class="btn btn-icon css-inspect-close">&times;</button>
    </div>
    <div id="css-inspect-drawer-body" class="css-inspect-drawer-body">
      <div class="css-inspect-empty">
        <div class="css-inspect-guide-title">CSS Inspect Mode</div>
        <div class="css-inspect-guide-text">左パネルの要素をクリックすると、右パネルの対応する要素との CSS プロパティの差分を表示します。</div>
        <div class="css-inspect-guide-steps">
          <span>1. 左パネルで要素をホバー（青枠表示）</span>
          <span>2. クリックして選択</span>
          <span>3. 右パネルの対応要素（オレンジ枠）と比較</span>
          <span>4. Esc キーで終了</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast Notification -->
  <div id="toast" class="toast hidden"></div>

  <!-- CommonJS shim: load shared modules (compiled with exports) in browser context -->
  <script>var exports = {}; var module = { exports: exports };</script>
  <script src="../shared/utils.js"></script>
  <script>
    var escapeHtml = module.exports.escapeHtml;
    var classifyProperty = module.exports.classifyProperty;
    var LAYOUT_PROPS = module.exports.LAYOUT_PROPS;
    var TEXT_PROPS = module.exports.TEXT_PROPS;
    var VISUAL_PROPS = module.exports.VISUAL_PROPS;
  </script>
  <script>exports = {}; module = { exports: exports };</script>
  <script src="../shared/constants.js"></script>
  <script>
    var ZOOM_STEP = module.exports.ZOOM_STEP;
    var MIN_ZOOM = module.exports.MIN_ZOOM;
    var MAX_ZOOM = module.exports.MAX_ZOOM;
    var DEFAULT_ZOOM = module.exports.DEFAULT_ZOOM;
    var SIDEBAR_WIDTH = module.exports.SIDEBAR_WIDTH;
  </script>
  <script src="scripts/device-presets.js"></script>
  <script src="scripts/sync.js"></script>
  <script src="scripts/css-compare.js"></script>
  <script src="scripts/ui-controls.js"></script>
  <script src="scripts/app.js"></script>
</body>
</html>
